package com.jira;

import static io.restassured.RestAssured.given;

import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import io.restassured.RestAssured;
import io.restassured.http.ContentType;
import io.restassured.path.json.JsonPath;
import io.restassured.response.Response;

public class EndToEndScript {
	
	String  AuthName;
	String  AuthValue;
	
	@BeforeMethod
	public void Initalization()
	{
		RestAssured.baseURI="http://localhost:8080";
	}
	
	@Test (priority=1)
	public void loginWithUNPass()
	{
		String b = "{ \"username\": \"princebiswas\", \"password\": \"Mymensingh1!\" }";
		
		Response res = given().contentType(ContentType.JSON).body(b)
                .when().post("/rest/auth/1/session")
                .then().assertThat().statusCode(200).extract().response();

        System.out.println(res.asString());
        
        String Auth = res.asString();
        
        JsonPath js = new JsonPath(Auth);
        
        AuthName =  js.get("session.name");
       
        AuthValue = js.get("session.value");
       
       System.out.println(AuthName+"="+AuthValue);
       
		
		
	}
	
	@Test(priority=2)
	public void getIssue()
	{
		Response res = given().log().all().contentType(ContentType.JSON).header("cookie","JSESSIONID="+AuthValue)
                .when().get("/rest/api/2/issue/AUT-1")
                .then().assertThat().statusCode(200).extract().response();
		
		System.out.println(res.asString());
	}
	
//	@Test(priority=2)
//	public void getIssue()
//	{
//		Response res = given().log().all().contentType(ContentType.JSON).header("cookie","JSESSIONID="+AuthValue)
//                .when().get("/rest/api/2/issue/AUT-1")
//                .then().assertThat().extract().response();
//		
//		System.out.println(res.asString());
//	}

}
